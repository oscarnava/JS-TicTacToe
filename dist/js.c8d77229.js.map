{"version":3,"sources":["js/board.js","js/player.js","js/ai.js","js/game.js","js/index.js"],"names":["Board","cells","Array","fill","checkIfWinner","player","validMove","move","getValidMoves","reduce","acc","cell","index","setCell","pos","value","winner","includes","toString","map","clone","Player","name","id","token","playMove","AI","CALC_TIME","playToEnd","gs","status","getStatus","valid","Math","floor","random","length","makeMove","stats","score","total","times","eta","Date","now","moveIdx","newGS","best","bestMove","bestScore","avg","calcMove","setTimeout","gameState","GameState","board","players","currentPlayer","setPlayer","isAI","getBoardState","newGame","nextPlayerTurn","ROBOHASH_URL","window","ticTacToe","document","querySelector","renderBoard","forEach","children","className","classList","add","toLowerCase","avatarImg","img","createElement","src","click","startGame","player1","player2","checked","replaceWith","style","display","play","event","target","contains","split","textContent","addEventListener"],"mappings":"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","file":"js.c8d77229.js","sourceRoot":"..","sourcesContent":["export default function Board(cells = new Array(9).fill(null)) {\n  const checkIfWinner = player => (\n    (cells[0] === player && cells[1] === player && cells[2] === player)\n    || (cells[3] === player && cells[4] === player && cells[5] === player)\n    || (cells[6] === player && cells[7] === player && cells[8] === player)\n    || (cells[0] === player && cells[3] === player && cells[6] === player)\n    || (cells[1] === player && cells[4] === player && cells[7] === player)\n    || (cells[2] === player && cells[5] === player && cells[8] === player)\n    || (cells[0] === player && cells[4] === player && cells[8] === player)\n    || (cells[2] === player && cells[4] === player && cells[6] === player)\n  );\n\n  const validMove = move => (move >= 1) && (move <= 9) && (cells[move - 1] === null);\n\n  const getValidMoves = () => cells\n    .reduce((acc, cell, index) => (cell === null ? [...acc, index + 1] : acc), []);\n\n  const setCell = (pos, value) => {\n    cells[pos - 1] = value;\n  };\n\n  const winner = () => {\n    if (checkIfWinner(0)) {\n      return 0;\n    }\n    if (checkIfWinner(1)) {\n      return 1;\n    }\n    if (!cells.includes(null)) {\n      return -1;\n    }\n    return null;\n  };\n\n  const toString = () => cells.map(cell => (cell === null ? ' ' : ['X', 'O'][cell]));\n\n  const clone = () => Board([...cells]);\n\n  return {\n    validMove,\n    getValidMoves,\n    setCell,\n    winner,\n    toString,\n    clone,\n  };\n}\n","export default function Player(name, id) {\n  const token = ['X', 'O'][id];\n\n  const playMove = () => {};\n\n  return {\n    name,\n    token,\n    playMove,\n  };\n}\n","export default function AI(name, id, CALC_TIME = 500) {\n  const token = ['X', 'O'][id];\n\n  const playToEnd = (gs) => {\n    let status;\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      status = gs.getStatus();\n      if (status.status !== 'playing') {\n        break;\n      }\n      const valid = gs.getValidMoves();\n      const move = valid[Math.floor(Math.random() * valid.length)];\n      gs.playMove(move);\n    }\n    return status;\n  };\n\n  const calcMove = (gs) => {\n    const stats = gs.getValidMoves().map(move => ({ move, score: 0, total: 0 }));\n    for (let times = 0, eta = Date.now() + CALC_TIME; Date.now() < eta && times < 5e4; times += 1) {\n      const moveIdx = Math.floor(Math.random() * stats.length);\n      const { move } = stats[moveIdx];\n      const newGS = gs.clone();\n      newGS.playMove(move);\n      const { status, player = {} } = playToEnd(newGS);\n      if (status === 'win') {\n        if (player.token === token) {\n          stats[moveIdx].score += 1;\n        } else {\n          stats[moveIdx].score -= 1;\n        }\n      }\n      stats[moveIdx].total += 1;\n    }\n\n    const best = stats.reduce(({ bestMove, bestScore }, { move, score, total }) => {\n      const avg = score / total;\n      if (avg > bestScore) {\n        return { bestMove: move, bestScore: avg };\n      }\n      return { bestMove, bestScore };\n    }, { bestMove: 0, bestScore: -9e99 });\n\n    return best.bestMove;\n  };\n\n  const playMove = (gs, makeMove) => {\n    const move = calcMove(gs);\n    setTimeout(() => makeMove(move), 100);\n  };\n\n  return {\n    name,\n    token,\n    playMove,\n  };\n}\n","import Board from './board.js';\nimport Player from './player.js';\nimport AI from './ai.js';\n\nconst gameState = (function GameState(board = Board(), players = [], currentPlayer = 0) {\n  const newGame = (player = 0) => {\n    board = Board();\n    currentPlayer = player;\n  };\n\n  const setPlayer = (name, id, isAI = false) => {\n    players[id] = isAI ? AI(name, id) : Player(name, id);\n  };\n\n  const playMove = (move) => {\n    if (board.validMove(move)) {\n      board.setCell(move, currentPlayer);\n      currentPlayer = 1 - currentPlayer;\n      return true;\n    }\n    return false;\n  };\n\n  const getStatus = () => {\n    switch (board.winner()) {\n      case 0:\n        return { status: 'win', player: players[0] };\n      case 1:\n        return { status: 'win', player: players[1] };\n      case -1:\n        return { status: 'draw' };\n      default:\n        return { status: 'playing' };\n    }\n  };\n\n  const getBoardState = () => board.toString();\n\n  const clone = () => GameState(board.clone(), [...players], currentPlayer);\n\n  const getValidMoves = () => board.getValidMoves();\n\n  const nextPlayerTurn = (makeMove) => {\n    players[currentPlayer].playMove(gameState, makeMove);\n  };\n\n  return {\n    setPlayer,\n    playMove,\n    getStatus,\n    getBoardState,\n    newGame,\n    clone,\n    getValidMoves,\n    nextPlayerTurn,\n  };\n}());\n\nexport default gameState;\n","import gameState from './game.js';\n\nconst ROBOHASH_URL = 'https://robohash.org';\n\nwindow.gs = gameState;\n\nconst ticTacToe = document.querySelector('#tic-tac-toe');\nconst winner = document.querySelector('#winner');\n\nfunction renderBoard() {\n  gameState.getBoardState().forEach((cell, index) => {\n    if (cell === ' ') {\n      document.querySelector('#tic-tac-toe').children[index].className = 'cell';\n    } else {\n      document.querySelector('#tic-tac-toe').children[index].classList.add(cell.toLowerCase());\n    }\n  });\n}\n\nfunction avatarImg(name, id) {\n  const img = document.createElement('img');\n  img.src = `${ROBOHASH_URL}/${name}`;\n  img.id = `avatar-${id}`;\n  return img;\n}\n\nfunction makeMove(move) {\n  document.querySelector(`#cell-${move}`).click();\n  renderBoard();\n}\n\nfunction startGame() {\n  gameState.newGame();\n\n  const player1 = document.querySelector('#player-1').value;\n  const player2 = document.querySelector('#player-2').value;\n\n  gameState.setPlayer(player1, 0, document.querySelector('#ai-1').checked);\n  gameState.setPlayer(player2, 1, document.querySelector('#ai-2').checked);\n  document.querySelector('#avatar-1').replaceWith(avatarImg(player1, 1));\n  document.querySelector('#avatar-2').replaceWith(avatarImg(player2, 2));\n\n  ticTacToe.style.display = 'grid';\n  renderBoard();\n  winner.style.display = 'none';\n\n  gameState.nextPlayerTurn(makeMove);\n}\n\nfunction play(event) {\n  if (!event.target.classList.contains('cell') || gameState.getStatus().status !== 'playing') {\n    return;\n  }\n\n  const id = event.target.id.split('-')[1];\n\n  gameState.playMove(id);\n  renderBoard();\n\n  const { status, player: { name } = {} } = gameState.getStatus();\n  if (status !== 'playing') {\n    winner.textContent = status === 'win' ? `Winner: ${name}` : 'No winner!';\n    winner.style.display = 'block';\n    document.querySelector('#play').textContent = 'Play again!';\n  } else {\n    gameState.nextPlayerTurn(makeMove);\n  }\n}\n\nticTacToe.addEventListener('click', play);\ndocument.querySelector('#play').addEventListener('click', startGame);\n"]}